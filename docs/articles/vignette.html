<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>rCISSVAE Vignette • rCISSVAE</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="rCISSVAE Vignette">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rCISSVAE</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1.0000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/CISS-VAE/rCISS-VAE" aria-label="GitHub"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<script src="vignette_files/kePrint-0.0.1/kePrint.js"></script><link href="vignette_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>rCISSVAE Vignette</h1>
            
            <h4 data-toc-skip class="date">2025-08-14</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/CISS-VAE/rCISS-VAE/blob/HEAD/vignettes/vignette.rmd" class="external-link"><code>vignettes/vignette.rmd</code></a></small>
      <div class="d-none name"><code>vignette.rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="installing-package">Installing package<a class="anchor" aria-label="anchor" href="#installing-package"></a>
</h3>
<p>Install devtools or remotes if not already installed:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span></span>
<span><span class="co"># or</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span></span></code></pre></div>
<p>The rCISSVAE package can be installed with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"CISS-VAE/rCISS-VAE"</span><span class="op">)</span></span>
<span><span class="co"># or</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"CISS-VAE/rCISS-VAE"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="ensuring-correct-virtual-environment-for-reticulate">Ensuring correct virtual environment for reticulate<a class="anchor" aria-label="anchor" href="#ensuring-correct-virtual-environment-for-reticulate"></a>
</h3>
<p>This package uses <code>reticulate</code> to interface with the
python version of the package <code>cissvae</code>. Therefore, it is
necessary to make sure that you have a venv or conda environment set up
that has the <code>cissvae</code> package installed. If you are
comfortable creating an environment and installing the package, great!
Then all you need to do is tell reticulate where to point.</p>
<p><strong>For Venv</strong></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">reticulate</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/reticulate/reference/use_python.html" class="external-link">use_virtualenv</a></span><span class="op">(</span><span class="st">"./.venv"</span>, required <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><strong>For conda</strong></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">reticulate</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/reticulate/reference/use_python.html" class="external-link">use_condaenv</a></span><span class="op">(</span><span class="st">"myenv"</span>, required <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="virtual-environment-helper-function">Virtual environment helper function<a class="anchor" aria-label="anchor" href="#virtual-environment-helper-function"></a>
</h4>
<p>If you do not want to manually create the virtual environment, you
can use the helper function <code><a href="../reference/create_cissvae_env.html">create_cissvae_env()</a></code> to create
a virtual environment (venv) in your current working directory.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/create_cissvae_env.html">create_cissvae_env</a></span><span class="op">(</span></span>
<span>  envname <span class="op">=</span> <span class="st">"cissvae_environment"</span>, <span class="co">## name of environment</span></span>
<span>  path <span class="op">=</span> <span class="cn">NULL</span>, <span class="co">## add path to wherever you want virtual environment to be</span></span>
<span>  install_python <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co">## set to TRUE if you want create_cisssvae_env to install python for you</span></span>
<span>  python_version <span class="op">=</span> <span class="st">"3.10"</span> <span class="co">## set to whatever version you want &gt;=3.10. Python 3.10 or 3.11 recommended</span></span>
<span><span class="op">)</span></span></code></pre></div>
<blockquote>
<p><strong>Note:</strong> If you run into issues with
create_cissvae_env(), you can create the virtual environment manually by
following this <a href="virtual_environment_tutorial.html">tutorial</a></p>
</blockquote>
<p>Once the environment is created, activate it using:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">reticulate</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/reticulate/reference/use_python.html" class="external-link">use_virtualenv</a></span><span class="op">(</span><span class="st">"./cissvae_environment"</span>, required <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># If you used a non-default environment name then,</span></span>
<span><span class="co"># reticulate::use_virtualenv("./your_environment_name", required = TRUE)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="optional-installing-other-python-packages">(optional) Installing other python packages<a class="anchor" aria-label="anchor" href="#optional-installing-other-python-packages"></a>
</h4>
<p>If you want to install other python packages (eg seaborn) to your
environment, you can use <a href="https://rstudio.github.io/reticulate/reference/virtualenv-tools.html" class="external-link"><code>reticulate::virtualenv_install()</code></a>.</p>
</div>
</div>
<div class="section level2">
<h2 id="quickstart">Quickstart<a class="anchor" aria-label="anchor" href="#quickstart"></a>
</h2>
<p>Once reticulate is pointing to the virtual environment containing the
<code>ciss_vae</code> python package, you can either use the
<code>run_cissvae</code> function or the <code>autotune_cissvae</code>
function.</p>
<p>If you know what hyperparameters you want to use for the model, use
the <code>run_cissvae</code> function.</p>
<div class="section level3">
<h3 id="run-cissvae-with-training-history-and-progress-tracking">Run CISSVAE with Training History and Progress Tracking<a class="anchor" aria-label="anchor" href="#run-cissvae-with-training-history-and-progress-tracking"></a>
</h3>
<p>Your data should be in a <code>DataFrame</code> format with optional
index column. If you already have clusters you want to use, they should
be in a separate vector from the dataframe. If you do not have clusters
to begin with, set ‘clusters’ in <code><a href="../reference/run_cissvae.html">run_cissvae()</a></code> to NULL.</p>
<div class="section level4">
<h4 id="example-dataset">Example Dataset<a class="anchor" aria-label="anchor" href="#example-dataset"></a>
</h4>
<p>With the rCISSVAE package comes a sample dataset with predetermined
clusters. We will use this for the sake of the tutorial.</p>
<p>The dataset, <code>df_missing</code> contains an index column as well
as the following:</p>
<table class="table table" style="font-size: 12px; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;">
<strong>Characteristic</strong>
</th>
<th style="text-align:left;">
<strong>N = 8,000</strong>
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Age
</td>
<td style="text-align:left;">
9.99 (8.73, 11.44)
</td>
</tr>
<tr>
<td style="text-align:left;">
Salary
</td>
<td style="text-align:left;">
5.70 (5.34, 6.17)
</td>
</tr>
<tr>
<td style="text-align:left;">
ZipCode10001
</td>
<td style="text-align:left;">
2,628 (33%)
</td>
</tr>
<tr>
<td style="text-align:left;">
ZipCode20002
</td>
<td style="text-align:left;">
2,697 (34%)
</td>
</tr>
<tr>
<td style="text-align:left;">
ZipCode30003
</td>
<td style="text-align:left;">
2,675 (33%)
</td>
</tr>
<tr>
<td style="text-align:left;">
Y11
</td>
<td style="text-align:left;">
0 (-11, 7)
</td>
</tr>
<tr>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:left;">
3,122
</td>
</tr>
<tr>
<td style="text-align:left;">
Y12
</td>
<td style="text-align:left;">
49 (-22, 58)
</td>
</tr>
<tr>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:left;">
3,118
</td>
</tr>
<tr>
<td style="text-align:left;">
Y13
</td>
<td style="text-align:left;">
72 (-17, 95)
</td>
</tr>
<tr>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:left;">
3,110
</td>
</tr>
<tr>
<td style="text-align:left;">
Y14
</td>
<td style="text-align:left;">
69 (-12, 119)
</td>
</tr>
<tr>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:left;">
3,129
</td>
</tr>
<tr>
<td style="text-align:left;">
Y15
</td>
<td style="text-align:left;">
72 (-12, 134)
</td>
</tr>
<tr>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:left;">
3,141
</td>
</tr>
<tr>
<td style="text-align:left;">
Y21
</td>
<td style="text-align:left;">
-9 (-22, 0)
</td>
</tr>
<tr>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:left;">
3,135
</td>
</tr>
<tr>
<td style="text-align:left;">
Y22
</td>
<td style="text-align:left;">
47 (-35, 58)
</td>
</tr>
<tr>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:left;">
3,094
</td>
</tr>
<tr>
<td style="text-align:left;">
Y23
</td>
<td style="text-align:left;">
74 (-29, 100)
</td>
</tr>
<tr>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:left;">
3,098
</td>
</tr>
<tr>
<td style="text-align:left;">
Y24
</td>
<td style="text-align:left;">
71 (-22, 128)
</td>
</tr>
<tr>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:left;">
3,146
</td>
</tr>
<tr>
<td style="text-align:left;">
Y25
</td>
<td style="text-align:left;">
73 (-22, 145)
</td>
</tr>
<tr>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:left;">
3,106
</td>
</tr>
<tr>
<td style="text-align:left;">
Y31
</td>
<td style="text-align:left;">
0 (-14, 11)
</td>
</tr>
<tr>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:left;">
2,067
</td>
</tr>
<tr>
<td style="text-align:left;">
Y32
</td>
<td style="text-align:left;">
59 (-17, 69)
</td>
</tr>
<tr>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:left;">
2,056
</td>
</tr>
<tr>
<td style="text-align:left;">
Y33
</td>
<td style="text-align:left;">
81 (-13, 101)
</td>
</tr>
<tr>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:left;">
2,013
</td>
</tr>
<tr>
<td style="text-align:left;">
Y34
</td>
<td style="text-align:left;">
79 (-6, 124)
</td>
</tr>
<tr>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:left;">
2,051
</td>
</tr>
<tr>
<td style="text-align:left;">
Y35
</td>
<td style="text-align:left;">
81 (-6, 139)
</td>
</tr>
<tr>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:left;">
2,054
</td>
</tr>
<tr>
<td style="text-align:left;">
Y41
</td>
<td style="text-align:left;">
0 (-6, 5)
</td>
</tr>
<tr>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:left;">
2,032
</td>
</tr>
<tr>
<td style="text-align:left;">
Y42
</td>
<td style="text-align:left;">
27 (-8, 32)
</td>
</tr>
<tr>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:left;">
2,022
</td>
</tr>
<tr>
<td style="text-align:left;">
Y43
</td>
<td style="text-align:left;">
37 (-5, 46)
</td>
</tr>
<tr>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:left;">
2,013
</td>
</tr>
<tr>
<td style="text-align:left;">
Y44
</td>
<td style="text-align:left;">
36 (-3, 56)
</td>
</tr>
<tr>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:left;">
2,023
</td>
</tr>
<tr>
<td style="text-align:left;">
Y45
</td>
<td style="text-align:left;">
37 (-3, 63)
</td>
</tr>
<tr>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:left;">
2,086
</td>
</tr>
<tr>
<td style="text-align:left;">
Y51
</td>
<td style="text-align:left;">
1.8 (-3.6, 5.8)
</td>
</tr>
<tr>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:left;">
2,077
</td>
</tr>
<tr>
<td style="text-align:left;">
Y52
</td>
<td style="text-align:left;">
25 (-5, 29)
</td>
</tr>
<tr>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:left;">
2,034
</td>
</tr>
<tr>
<td style="text-align:left;">
Y53
</td>
<td style="text-align:left;">
34 (-3, 41)
</td>
</tr>
<tr>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:left;">
1,976
</td>
</tr>
<tr>
<td style="text-align:left;">
Y54
</td>
<td style="text-align:left;">
33 (-1, 50)
</td>
</tr>
<tr>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:left;">
2,047
</td>
</tr>
<tr>
<td style="text-align:left;">
Y55
</td>
<td style="text-align:left;">
34 (-1, 56)
</td>
</tr>
<tr>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:left;">
2,050
</td>
</tr>
</tbody>
</table>
<p>Age, Salary and ZipCode columns represent demographic data with no
missingness and columns Y1t-Y5t represent biomarker data obtained at
different timepoints t.</p>
</div>
<div class="section level4">
<h4 id="explanation-of-run_cissvae-parameters">Explanation of <code>run_cissvae()</code> Parameters<a class="anchor" aria-label="anchor" href="#explanation-of-run_cissvae-parameters"></a>
</h4>
<p>The <code><a href="../reference/run_cissvae.html">run_cissvae()</a></code> function is a comprehensive wrapper
for all basic steps in running the CISS-VAE model, including dataset
preparation, optional clustering, and running the imputation model.</p>
<details><summary>
Click for a detailed explanation of all parameters
</summary><p><strong>Dataset Parameters</strong> - data: A <code>DataFrame</code>
containing the dataset to be imputed. Contains optional index
column.<br>
- index_col: Name of index column to be preserved when imputing. Index
column will not have any values held out for validation<br>
- val_proportion: Fraction of non-missing entries to hold out for
validation during training. To use different proportions for each
cluster, pass a vector.<br>
- replacement_value: Fill value for masked entries during training.
Default is 0.0.<br>
- columns_ignore: Character or integer vector containing columns to
exclude when selecting validation data. These columns will be used
during training. - print_dataset: Set <code>TRUE</code> to print dataset
summary information during processing.</p>
<p><strong>Clustering Parameters (optional)</strong><br>
- clusters: Vector of one cluster label per row of ‘data’ dataframe. If
NULL, will automatically determine clusters using <a href="">HDBSCAN</a>
or <a href="https://scikit-learn.org/stable/modules/generated/sklearn.cluster.KMeans.html" class="external-link">KMeans</a>.<br>
- n_clusters: Number of clusters for KMeans clustering when ‘clusters’
is NULL. If n_clusters is NULL, will use <a href="">HDBSCAN</a> for
clustering.<br>
- leiden_resolution: Epsilon parameter for <a href="">HDBSCAN</a>
clustering when automatic clustering is used.<br>
- missingness_proportion_matrix: Optional pre-computed missingness
proportion matrix for feature-based clustering. If provided, clustering
will be based on these proportions instead of direct 0/1 missingness
pattern.<br>
- scale_features: Set <code>TRUE</code> to scale features when using
missingness proportion matrix clustering.</p>
<p><strong>Model Parameters</strong><br>
- hidden_dims: A vector containing the sizes of hidden layers in
encoder/decoder. The length of this vector determines number of hidden
layers.<br>
- latent_dim: The dimension of the latent space representation.<br>
- layer_order_enc: A vector stating the pattern of ‘shared’ and
‘unshared’ layers for the encoder. The length must match
<code>length(hidden_dims)</code>. Default c(‘unshared’, ‘unshared’,
‘unshared’).<br>
- layer_order_dec: A vector stating the pattern of ‘shared’ and
‘unshared’ layers for the decoder. The length must match
<code>length(hidden_dims)</code>. Default c(‘shared’, ‘shared’,
‘shared’).<br>
- latent_shared: Whether latent space weights are shared across
clusters. If FALSE, will have separate latent weights for each
cluster.<br>
- ouput_shared: If FALSE, will have separate output layer for each
cluster.<br>
- batch_size: Integer. Mini-batch size for training. Larger values may
improve training stability but require more memory.<br>
- return_model: If TRUE, returns the model object. Set TRUE to use
<code><a href="../reference/plot_vae_architecture.html">plot_vae_architecture()</a></code> after running.<br>
- epochs: Number of epochs for initial training phase<br>
- initial_lr: Initial learning rate for optimizer.<br>
- decay_factor: Exponential decay factor for learning rate.<br>
- beta: Weight for KL divergence term in VAE loss function.<br>
- device: Device specification for computation (“cpu” or “cuda”). If
NULL, automatically selects best available device.<br>
- max-loops: Max number of impute-refit loops to perform.<br>
- patience: Training stops if validation loss doesn’t improve for this
many consecutive impute-refit loops.<br>
- epochs-per-loop: Number of epochs per refit loop. If null, uses same
value as <code>epochs</code>. Default NULL.<br>
- decay_factor_refit: Decay factor for refit loops. If NULL, uses same
value as decay_factor. Default NULL.<br>
- beta_refit: KL weight for refit loops. If NULL, uses same value as
beta. Default NULL.</p>
<p><strong>Optional Parameters</strong><br>
- verbose: Set <code>TRUE</code> to print MSE for each loop as it runs.
- return_silhouettes: If clusters not given, will return silhouette
scores for automatic clustering. - return_history: If <code>TRUE</code>,
returns training history as data.frame. Good for checking for
overfitting. - return_dataset: If <code>TRUE</code>, returns
ClusterDataset object.</p>
</details>
</div>
<div class="section level4">
<h4 id="running-the-imputation">Running the imputation<a class="anchor" aria-label="anchor" href="#running-the-imputation"></a>
</h4>
<p>To run the imputation model, first load your data. You can use the
<code>cluster_summary()</code> function to visualize the missingness by
cluster.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/reticulate/" class="external-link">reticulate</a></span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ciss-vae.github.io/rCISS-VAE">rCISSVAE</a></span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Set correct virtualenv</span></span>
<span><span class="fu">reticulate</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/reticulate/reference/use_python.html" class="external-link">use_virtualenv</a></span><span class="op">(</span><span class="st">"./cissvae_environment"</span>, required <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Load the data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">df_missing</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">clusters</span><span class="op">)</span> <span class="co">## actual cluster labels in clusters$clusters (other column is index)</span></span>
<span></span>
<span><span class="fu">cluster_summary</span><span class="op">(</span><span class="va">df_missing</span>, <span class="va">clusters</span><span class="op">$</span><span class="va">clusters</span>, index_col <span class="op">=</span> <span class="st">"index"</span><span class="op">)</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html" class="external-link">kable_styling</a></span><span class="op">(</span>font_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span></code></pre></div>
<table class="table table" style="font-size: 12px; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;">
Variable
</th>
<th style="text-align:left;">
Overall
</th>
<th style="text-align:left;">
Cluster 0
</th>
<th style="text-align:left;">
Cluster 1
</th>
<th style="text-align:left;">
Cluster 2
</th>
<th style="text-align:left;">
Cluster 3
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
N
</td>
<td style="text-align:left;">
8000
</td>
<td style="text-align:left;">
2000
</td>
<td style="text-align:left;">
2000
</td>
<td style="text-align:left;">
2000
</td>
<td style="text-align:left;">
2000
</td>
</tr>
<tr>
<td style="text-align:left;">
Age
</td>
<td style="text-align:left;">
10.2 (2.08)
</td>
<td style="text-align:left;">
10.1 (2.04)
</td>
<td style="text-align:left;">
10.19 (2.08)
</td>
<td style="text-align:left;">
10.21 (2.14)
</td>
<td style="text-align:left;">
10.29 (2.06)
</td>
</tr>
<tr>
<td style="text-align:left;">
Salary
</td>
<td style="text-align:left;">
5.82 (0.61)
</td>
<td style="text-align:left;">
5.81 (0.61)
</td>
<td style="text-align:left;">
5.83 (0.62)
</td>
<td style="text-align:left;">
5.83 (0.61)
</td>
<td style="text-align:left;">
5.81 (0.6)
</td>
</tr>
<tr>
<td style="text-align:left;">
ZipCode10001
</td>
<td style="text-align:left;">
0.33 (0.47)
</td>
<td style="text-align:left;">
0.32 (0.47)
</td>
<td style="text-align:left;">
0.34 (0.47)
</td>
<td style="text-align:left;">
0.33 (0.47)
</td>
<td style="text-align:left;">
0.32 (0.47)
</td>
</tr>
<tr>
<td style="text-align:left;">
ZipCode20002
</td>
<td style="text-align:left;">
0.34 (0.47)
</td>
<td style="text-align:left;">
0.35 (0.48)
</td>
<td style="text-align:left;">
0.33 (0.47)
</td>
<td style="text-align:left;">
0.33 (0.47)
</td>
<td style="text-align:left;">
0.34 (0.47)
</td>
</tr>
<tr>
<td style="text-align:left;">
ZipCode30003
</td>
<td style="text-align:left;">
0.33 (0.47)
</td>
<td style="text-align:left;">
0.33 (0.47)
</td>
<td style="text-align:left;">
0.34 (0.47)
</td>
<td style="text-align:left;">
0.34 (0.47)
</td>
<td style="text-align:left;">
0.33 (0.47)
</td>
</tr>
<tr>
<td style="text-align:left;">
Y11
</td>
<td style="text-align:left;">
-2.82 (13.25), 3122 (39%) missing
</td>
<td style="text-align:left;">
-21.2 (10.08), 1281 (64%) missing
</td>
<td style="text-align:left;">
-16.04 (8.89), 1288 (64.4%) missing
</td>
<td style="text-align:left;">
8.39 (5.39)
</td>
<td style="text-align:left;">
-2.68 (5.86), 553 (27.6%) missing
</td>
</tr>
<tr>
<td style="text-align:left;">
Y12
</td>
<td style="text-align:left;">
22.23 (42.54), 3118 (39%) missing
</td>
<td style="text-align:left;">
68.9 (11.29), 1264 (63.2%) missing
</td>
<td style="text-align:left;">
-26.43 (9.3), 1283 (64.2%) missing
</td>
<td style="text-align:left;">
55.35 (6.18)
</td>
<td style="text-align:left;">
-23.73 (7.87), 571 (28.6%) missing
</td>
</tr>
<tr>
<td style="text-align:left;">
Y13
</td>
<td style="text-align:left;">
42.75 (57.09), 3110 (38.9%) missing
</td>
<td style="text-align:left;">
77.28 (12.34), 1289 (64.4%) missing
</td>
<td style="text-align:left;">
-24.92 (8.71), 1264 (63.2%) missing
</td>
<td style="text-align:left;">
98.14 (11.87)
</td>
<td style="text-align:left;">
-16.52 (6.63), 557 (27.9%) missing
</td>
</tr>
<tr>
<td style="text-align:left;">
Y14
</td>
<td style="text-align:left;">
55.55 (66.05), 3129 (39.1%) missing
</td>
<td style="text-align:left;">
73.32 (11.53), 1300 (65%) missing
</td>
<td style="text-align:left;">
-20.78 (7.8), 1283 (64.2%) missing
</td>
<td style="text-align:left;">
125.13 (16.23)
</td>
<td style="text-align:left;">
-11.08 (5.61), 546 (27.3%) missing
</td>
</tr>
<tr>
<td style="text-align:left;">
Y15
</td>
<td style="text-align:left;">
63.77 (72.61), 3141 (39.3%) missing
</td>
<td style="text-align:left;">
75.96 (11.74), 1273 (63.6%) missing
</td>
<td style="text-align:left;">
-11.93 (6.41), 1293 (64.7%) missing
</td>
<td style="text-align:left;">
141.25 (19.01)
</td>
<td style="text-align:left;">
-13.64 (6.4), 575 (28.8%) missing
</td>
</tr>
<tr>
<td style="text-align:left;">
Y21
</td>
<td style="text-align:left;">
-12.23 (15.68), 3135 (39.2%) missing
</td>
<td style="text-align:left;">
-33.45 (12.23), 1266 (63.3%) missing
</td>
<td style="text-align:left;">
-27.52 (10.59), 1292 (64.6%) missing
</td>
<td style="text-align:left;">
0.9 (6.62)
</td>
<td style="text-align:left;">
-12.14 (7.39), 577 (28.9%) missing
</td>
</tr>
<tr>
<td style="text-align:left;">
Y22
</td>
<td style="text-align:left;">
16.04 (48.68), 3094 (38.7%) missing
</td>
<td style="text-align:left;">
69.27 (11.68), 1266 (63.3%) missing
</td>
<td style="text-align:left;">
-39.51 (11.64), 1276 (63.8%) missing
</td>
<td style="text-align:left;">
54.43 (6.21)
</td>
<td style="text-align:left;">
-36.19 (9.78), 552 (27.6%) missing
</td>
</tr>
<tr>
<td style="text-align:left;">
Y23
</td>
<td style="text-align:left;">
39.92 (65.7), 3098 (38.7%) missing
</td>
<td style="text-align:left;">
78.76 (13.09), 1273 (63.6%) missing
</td>
<td style="text-align:left;">
-38.1 (11), 1275 (63.8%) missing
</td>
<td style="text-align:left;">
103.87 (12.61)
</td>
<td style="text-align:left;">
-28.73 (8.52), 550 (27.5%) missing
</td>
</tr>
<tr>
<td style="text-align:left;">
Y24
</td>
<td style="text-align:left;">
55.14 (75.63), 3146 (39.3%) missing
</td>
<td style="text-align:left;">
75.32 (12.36), 1302 (65.1%) missing
</td>
<td style="text-align:left;">
-32.22 (9.53), 1287 (64.3%) missing
</td>
<td style="text-align:left;">
134.69 (17.51)
</td>
<td style="text-align:left;">
-21.7 (7.16), 557 (27.9%) missing
</td>
</tr>
<tr>
<td style="text-align:left;">
Y25
</td>
<td style="text-align:left;">
63.86 (83.02), 3106 (38.8%) missing
</td>
<td style="text-align:left;">
77.63 (12.52), 1257 (62.9%) missing
</td>
<td style="text-align:left;">
-22.23 (7.81), 1294 (64.7%) missing
</td>
<td style="text-align:left;">
153.08 (20.72)
</td>
<td style="text-align:left;">
-24.63 (8.12), 555 (27.8%) missing
</td>
</tr>
<tr>
<td style="text-align:left;">
Y31
</td>
<td style="text-align:left;">
-2.38 (15.47), 2067 (25.8%) missing
</td>
<td style="text-align:left;">
-18.28 (10.37), 192 (9.6%) missing
</td>
<td style="text-align:left;">
-13.16 (9.15), 1285 (64.2%) missing
</td>
<td style="text-align:left;">
13.4 (5.48)
</td>
<td style="text-align:left;">
1.07 (6.02), 590 (29.5%) missing
</td>
</tr>
<tr>
<td style="text-align:left;">
Y32
</td>
<td style="text-align:left;">
35.48 (44.33), 2056 (25.7%) missing
</td>
<td style="text-align:left;">
74.39 (10.92), 206 (10.3%) missing
</td>
<td style="text-align:left;">
-24.27 (9.9), 1287 (64.3%) missing
</td>
<td style="text-align:left;">
62.21 (6.63)
</td>
<td style="text-align:left;">
-20.65 (8), 563 (28.1%) missing
</td>
</tr>
<tr>
<td style="text-align:left;">
Y33
</td>
<td style="text-align:left;">
54.8 (56.83), 2013 (25.2%) missing
</td>
<td style="text-align:left;">
83.77 (12.9), 203 (10.2%) missing
</td>
<td style="text-align:left;">
-23.25 (9.53), 1267 (63.4%) missing
</td>
<td style="text-align:left;">
107.81 (12.65)
</td>
<td style="text-align:left;">
-14.43 (7.08), 543 (27.1%) missing
</td>
</tr>
<tr>
<td style="text-align:left;">
Y34
</td>
<td style="text-align:left;">
66.6 (63.23), 2051 (25.6%) missing
</td>
<td style="text-align:left;">
81.4 (12.51), 195 (9.8%) missing
</td>
<td style="text-align:left;">
-16.58 (7.73), 1275 (63.8%) missing
</td>
<td style="text-align:left;">
135.95 (17.14)
</td>
<td style="text-align:left;">
-7.48 (5.83), 581 (29%) missing
</td>
</tr>
<tr>
<td style="text-align:left;">
Y35
</td>
<td style="text-align:left;">
73.13 (69.46), 2054 (25.7%) missing
</td>
<td style="text-align:left;">
83.22 (12.63), 204 (10.2%) missing
</td>
<td style="text-align:left;">
-7.56 (6.11), 1285 (64.2%) missing
</td>
<td style="text-align:left;">
152.77 (20)
</td>
<td style="text-align:left;">
-10.27 (6.66), 565 (28.2%) missing
</td>
</tr>
<tr>
<td style="text-align:left;">
Y41
</td>
<td style="text-align:left;">
-1.03 (6.75), 2032 (25.4%) missing
</td>
<td style="text-align:left;">
-8.43 (4.11), 184 (9.2%) missing
</td>
<td style="text-align:left;">
-5.47 (3.4), 1279 (64%) missing
</td>
<td style="text-align:left;">
6 (2.08)
</td>
<td style="text-align:left;">
0.79 (2.29), 569 (28.4%) missing
</td>
</tr>
<tr>
<td style="text-align:left;">
Y42
</td>
<td style="text-align:left;">
16.62 (20.72), 2022 (25.3%) missing
</td>
<td style="text-align:left;">
35.33 (6.07), 199 (9.9%) missing
</td>
<td style="text-align:left;">
-10.85 (3.89), 1282 (64.1%) missing
</td>
<td style="text-align:left;">
28.63 (3.53)
</td>
<td style="text-align:left;">
-9.43 (3.15), 541 (27%) missing
</td>
</tr>
<tr>
<td style="text-align:left;">
Y43
</td>
<td style="text-align:left;">
25.38 (25.81), 2013 (25.2%) missing
</td>
<td style="text-align:left;">
38.94 (6.89), 217 (10.8%) missing
</td>
<td style="text-align:left;">
-9.74 (3.42), 1242 (62.1%) missing
</td>
<td style="text-align:left;">
49.16 (6.44)
</td>
<td style="text-align:left;">
-5.82 (2.54), 554 (27.7%) missing
</td>
</tr>
<tr>
<td style="text-align:left;">
Y44
</td>
<td style="text-align:left;">
30.33 (29.1), 2023 (25.3%) missing
</td>
<td style="text-align:left;">
37.26 (6.6), 186 (9.3%) missing
</td>
<td style="text-align:left;">
-8.17 (3.15), 1280 (64%) missing
</td>
<td style="text-align:left;">
62.18 (8.63)
</td>
<td style="text-align:left;">
-3.33 (2.17), 557 (27.9%) missing
</td>
</tr>
<tr>
<td style="text-align:left;">
Y45
</td>
<td style="text-align:left;">
33.81 (31.9), 2086 (26.1%) missing
</td>
<td style="text-align:left;">
38.57 (6.75), 204 (10.2%) missing
</td>
<td style="text-align:left;">
-3.85 (2.5), 1305 (65.2%) missing
</td>
<td style="text-align:left;">
69.91 (9.98)
</td>
<td style="text-align:left;">
-4.52 (2.45), 577 (28.9%) missing
</td>
</tr>
<tr>
<td style="text-align:left;">
Y51
</td>
<td style="text-align:left;">
0.95 (5.79), 2077 (26%) missing
</td>
<td style="text-align:left;">
-5.38 (3.58), 222 (11.1%) missing
</td>
<td style="text-align:left;">
-2.94 (3.05), 1279 (64%) missing
</td>
<td style="text-align:left;">
6.88 (1.91)
</td>
<td style="text-align:left;">
2.48 (2.04), 576 (28.8%) missing
</td>
</tr>
<tr>
<td style="text-align:left;">
Y52
</td>
<td style="text-align:left;">
16 (17.75), 2034 (25.4%) missing
</td>
<td style="text-align:left;">
32.07 (5.19), 209 (10.4%) missing
</td>
<td style="text-align:left;">
-7.54 (3.37), 1283 (64.2%) missing
</td>
<td style="text-align:left;">
26.28 (3.07)
</td>
<td style="text-align:left;">
-6.26 (2.73), 542 (27.1%) missing
</td>
</tr>
<tr>
<td style="text-align:left;">
Y53
</td>
<td style="text-align:left;">
23.58 (22.01), 1976 (24.7%) missing
</td>
<td style="text-align:left;">
35.23 (5.83), 184 (9.2%) missing
</td>
<td style="text-align:left;">
-6.5 (3.01), 1243 (62.1%) missing
</td>
<td style="text-align:left;">
43.78 (5.51)
</td>
<td style="text-align:left;">
-3.13 (2.22), 549 (27.4%) missing
</td>
</tr>
<tr>
<td style="text-align:left;">
Y54
</td>
<td style="text-align:left;">
27.66 (24.95), 2047 (25.6%) missing
</td>
<td style="text-align:left;">
33.71 (5.52), 217 (10.8%) missing
</td>
<td style="text-align:left;">
-5.23 (2.74), 1281 (64%) missing
</td>
<td style="text-align:left;">
54.94 (7.4)
</td>
<td style="text-align:left;">
-1.08 (1.92), 549 (27.4%) missing
</td>
</tr>
<tr>
<td style="text-align:left;">
Y55
</td>
<td style="text-align:left;">
30.49 (27.35), 2050 (25.6%) missing
</td>
<td style="text-align:left;">
34.83 (5.69), 207 (10.3%) missing
</td>
<td style="text-align:left;">
-1.63 (2.14), 1292 (64.6%) missing
</td>
<td style="text-align:left;">
61.59 (8.52)
</td>
<td style="text-align:left;">
-2.09 (2.15), 551 (27.6%) missing
</td>
</tr>
</tbody>
</table>
<p>Then, plug your data and clusters into the <code><a href="../reference/run_cissvae.html">run_cissvae()</a></code>
function.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Run the imputation model. </span></span>
<span><span class="va">dat</span> <span class="op">=</span> <span class="fu"><a href="../reference/run_cissvae.html">run_cissvae</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">df_missing</span>,</span>
<span>  index_col <span class="op">=</span> <span class="st">"index"</span>,</span>
<span>  val_proportion <span class="op">=</span> <span class="fl">0.1</span>, <span class="co">## pass a vector for different proportions by cluster</span></span>
<span>  columns_ignore <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Age"</span>, <span class="st">"Salary"</span>, <span class="st">"ZipCode10001"</span>, <span class="st">"ZipCode20002"</span>, <span class="st">"ZipCode30003"</span><span class="op">)</span>, <span class="co">## If there are columns in addition to the index you want to ignore when selecting validation set, list them here. In this case, we ignore the 'demographic' columns because we do not want to remove data from them for validation purposes. </span></span>
<span>  clusters <span class="op">=</span> <span class="va">clusters</span><span class="op">$</span><span class="va">clusters</span>, <span class="co">## we have precomputed cluster labels so we pass them here</span></span>
<span>  epochs <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  return_silhouettes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  return_history <span class="op">=</span> <span class="cn">TRUE</span>,  <span class="co"># Get detailed training history</span></span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  return_model <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co">## Allows for plotting model schematic</span></span>
<span>  device <span class="op">=</span> <span class="st">"cpu"</span>,  <span class="co"># Explicit device selection</span></span>
<span>  layer_order_enc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"unshared"</span>, <span class="st">"shared"</span>, <span class="st">"unshared"</span><span class="op">)</span>,</span>
<span>  layer_order_dec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"shared"</span>, <span class="st">"unshared"</span>, <span class="st">"shared"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Retrieve results</span></span>
<span><span class="va">imputed_df</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">$</span><span class="va">imputed</span></span>
<span><span class="va">silhouette</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">$</span><span class="va">silhouettes</span></span>
<span><span class="va">training_history</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">$</span><span class="va">history</span>  <span class="co"># Detailed training progress</span></span>
<span></span>
<span><span class="co">## Plot training progress</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">training_history</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">training_history</span><span class="op">$</span><span class="va">epoch</span>, <span class="va">training_history</span><span class="op">$</span><span class="va">loss</span>, </span>
<span>       type <span class="op">=</span> <span class="st">"l"</span>, main <span class="op">=</span> <span class="st">"Training Loss Over Time"</span>, </span>
<span>       xlab <span class="op">=</span> <span class="st">"Epoch"</span>, ylab <span class="op">=</span> <span class="st">"Loss"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_vae_architecture.html">plot_vae_architecture</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">dat</span><span class="op">$</span><span class="va">model</span>, save_path <span class="op">=</span> <span class="st">"test_plot_arch.png"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Cluster dataset:</span></span>
<span><span class="co">#&gt;  ClusterDataset(n_samples=8000, n_features=30, n_clusters=4)</span></span>
<span><span class="co">#&gt;   • Original missing: 61800 / 200000 (30.90%)</span></span>
<span><span class="co">#&gt;   • Validation held-out: 13783 (9.97% of non-missing)</span></span>
<span><span class="co">#&gt;   • .data shape:     (8000, 30)</span></span>
<span><span class="co">#&gt;   • .masks shape:    (8000, 30)</span></span>
<span><span class="co">#&gt;   • .val_data shape: (8000, 30)</span></span>
<span><span class="co">#&gt; Plot saved to: test_plot_arch.png</span></span></code></pre>
<p><img src="test_plot_arch.png"></p>
</div>
</div>
<div class="section level3">
<h3 id="clustering-features-by-missingness-patterns">Clustering Features by Missingness Patterns<a class="anchor" aria-label="anchor" href="#clustering-features-by-missingness-patterns"></a>
</h3>
<p>Before running CISS-VAE, you can cluster features based on their
missingness patterns. This helps identify features that tend to be
missing together systematically, which can improve imputation
quality.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ciss-vae.github.io/rCISS-VAE">rCISSVAE</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">df_missing</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">cluster_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cluster_on_missing.html">cluster_on_missing</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">df_missing</span>,</span>
<span>  cols_ignore <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"index"</span>, <span class="st">"Age"</span>, <span class="st">"Salary"</span>, <span class="st">"ZipCode10001"</span>, <span class="st">"ZipCode20002"</span>, <span class="st">"ZipCode30003"</span><span class="op">)</span>,</span>
<span>  n_clusters <span class="op">=</span> <span class="fl">4</span>,  <span class="co"># Use KMeans with 4 clusters</span></span>
<span>  seed <span class="op">=</span> <span class="fl">42</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">cluster_summary</span><span class="op">(</span><span class="va">df_missing</span>, <span class="va">cluster_result</span><span class="op">$</span><span class="va">clusters</span>, index_col <span class="op">=</span> <span class="st">"index"</span><span class="op">)</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html" class="external-link">kable_styling</a></span><span class="op">(</span>font_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span></code></pre></div>
<table class="table table" style="font-size: 12px; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;">
Variable
</th>
<th style="text-align:left;">
Overall
</th>
<th style="text-align:left;">
Cluster 0
</th>
<th style="text-align:left;">
Cluster 1
</th>
<th style="text-align:left;">
Cluster 2
</th>
<th style="text-align:left;">
Cluster 3
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
N
</td>
<td style="text-align:left;">
8000
</td>
<td style="text-align:left;">
1089
</td>
<td style="text-align:left;">
4827
</td>
<td style="text-align:left;">
1251
</td>
<td style="text-align:left;">
833
</td>
</tr>
<tr>
<td style="text-align:left;">
Age
</td>
<td style="text-align:left;">
10.2 (2.08)
</td>
<td style="text-align:left;">
10.2 (2.04)
</td>
<td style="text-align:left;">
10.19 (2.09)
</td>
<td style="text-align:left;">
10.23 (2.09)
</td>
<td style="text-align:left;">
10.22 (2.05)
</td>
</tr>
<tr>
<td style="text-align:left;">
Salary
</td>
<td style="text-align:left;">
5.82 (0.61)
</td>
<td style="text-align:left;">
5.85 (0.63)
</td>
<td style="text-align:left;">
5.82 (0.61)
</td>
<td style="text-align:left;">
5.81 (0.59)
</td>
<td style="text-align:left;">
5.8 (0.61)
</td>
</tr>
<tr>
<td style="text-align:left;">
ZipCode10001
</td>
<td style="text-align:left;">
0.33 (0.47)
</td>
<td style="text-align:left;">
0.34 (0.47)
</td>
<td style="text-align:left;">
0.33 (0.47)
</td>
<td style="text-align:left;">
0.32 (0.47)
</td>
<td style="text-align:left;">
0.35 (0.48)
</td>
</tr>
<tr>
<td style="text-align:left;">
ZipCode20002
</td>
<td style="text-align:left;">
0.34 (0.47)
</td>
<td style="text-align:left;">
0.32 (0.47)
</td>
<td style="text-align:left;">
0.34 (0.47)
</td>
<td style="text-align:left;">
0.33 (0.47)
</td>
<td style="text-align:left;">
0.33 (0.47)
</td>
</tr>
<tr>
<td style="text-align:left;">
ZipCode30003
</td>
<td style="text-align:left;">
0.33 (0.47)
</td>
<td style="text-align:left;">
0.34 (0.47)
</td>
<td style="text-align:left;">
0.33 (0.47)
</td>
<td style="text-align:left;">
0.35 (0.48)
</td>
<td style="text-align:left;">
0.32 (0.47)
</td>
</tr>
<tr>
<td style="text-align:left;">
Y11
</td>
<td style="text-align:left;">
-2.82 (13.25), 3122 (39%) missing
</td>
<td style="text-align:left;">
-2.5 (5.49), 1072 (98.4%) missing
</td>
<td style="text-align:left;">
-0.08 (12.9), 1108 (23%) missing
</td>
<td style="text-align:left;">
-4.23 (7.41), 856 (68.4%) missing
</td>
<td style="text-align:left;">
-15.73 (9.07), 86 (10.3%) missing
</td>
</tr>
<tr>
<td style="text-align:left;">
Y12
</td>
<td style="text-align:left;">
22.23 (42.54), 3118 (39%) missing
</td>
<td style="text-align:left;">
-21.45 (18.4), 520 (47.8%) missing
</td>
<td style="text-align:left;">
41.4 (34.54), 1570 (32.5%) missing
</td>
<td style="text-align:left;">
-11.17 (34.82), 379 (30.3%) missing
</td>
<td style="text-align:left;">
-23.67 (17.98), 649 (77.9%) missing
</td>
</tr>
<tr>
<td style="text-align:left;">
Y13
</td>
<td style="text-align:left;">
42.75 (57.09), 3110 (38.9%) missing
</td>
<td style="text-align:left;">
-16.71 (17.7), 512 (47%) missing
</td>
<td style="text-align:left;">
70.19 (46.94), 1555 (32.2%) missing
</td>
<td style="text-align:left;">
-7.1 (34.73), 418 (33.4%) missing
</td>
<td style="text-align:left;">
-24.19 (13.31), 625 (75%) missing
</td>
</tr>
<tr>
<td style="text-align:left;">
Y14
</td>
<td style="text-align:left;">
55.55 (66.05), 3129 (39.1%) missing
</td>
<td style="text-align:left;">
-11.33 (22.61), 94 (8.6%) missing
</td>
<td style="text-align:left;">
77.71 (60.24), 1151 (23.8%) missing
</td>
<td style="text-align:left;">
-1.72 (29.31), 1244 (99.4%) missing
</td>
<td style="text-align:left;">
-19.61 (11.71), 640 (76.8%) missing
</td>
</tr>
<tr>
<td style="text-align:left;">
Y15
</td>
<td style="text-align:left;">
63.77 (72.61), 3141 (39.3%) missing
</td>
<td style="text-align:left;">
-9.57 (17.52), 530 (48.7%) missing
</td>
<td style="text-align:left;">
97.97 (63.61), 1590 (32.9%) missing
</td>
<td style="text-align:left;">
0.25 (32.9), 386 (30.9%) missing
</td>
<td style="text-align:left;">
-10.88 (11.75), 635 (76.2%) missing
</td>
</tr>
<tr>
<td style="text-align:left;">
Y21
</td>
<td style="text-align:left;">
-12.23 (15.68), 3135 (39.2%) missing
</td>
<td style="text-align:left;">
-12.51 (7.5), 1073 (98.5%) missing
</td>
<td style="text-align:left;">
-9.09 (15.36), 1111 (23%) missing
</td>
<td style="text-align:left;">
-13.64 (8.59), 860 (68.7%) missing
</td>
<td style="text-align:left;">
-27.2 (10.77), 91 (10.9%) missing
</td>
</tr>
<tr>
<td style="text-align:left;">
Y22
</td>
<td style="text-align:left;">
16.04 (48.68), 3094 (38.7%) missing
</td>
<td style="text-align:left;">
-33.57 (21.45), 530 (48.7%) missing
</td>
<td style="text-align:left;">
38.02 (39.56), 1552 (32.2%) missing
</td>
<td style="text-align:left;">
-22.93 (38.96), 361 (28.9%) missing
</td>
<td style="text-align:left;">
-36.52 (21.19), 651 (78.2%) missing
</td>
</tr>
<tr>
<td style="text-align:left;">
Y23
</td>
<td style="text-align:left;">
39.92 (65.7), 3098 (38.7%) missing
</td>
<td style="text-align:left;">
-28.12 (21.91), 504 (46.3%) missing
</td>
<td style="text-align:left;">
71.7 (53.7), 1550 (32.1%) missing
</td>
<td style="text-align:left;">
-18.01 (39.86), 412 (32.9%) missing
</td>
<td style="text-align:left;">
-38.22 (13.56), 632 (75.9%) missing
</td>
</tr>
<tr>
<td style="text-align:left;">
Y24
</td>
<td style="text-align:left;">
55.14 (75.63), 3146 (39.3%) missing
</td>
<td style="text-align:left;">
-21.53 (26.21), 97 (8.9%) missing
</td>
<td style="text-align:left;">
80.77 (68.85), 1176 (24.4%) missing
</td>
<td style="text-align:left;">
5.64 (47.55), 1237 (98.9%) missing
</td>
<td style="text-align:left;">
-30.21 (15.33), 636 (76.4%) missing
</td>
</tr>
<tr>
<td style="text-align:left;">
Y25
</td>
<td style="text-align:left;">
63.86 (83.02), 3106 (38.8%) missing
</td>
<td style="text-align:left;">
-19.73 (20.2), 530 (48.7%) missing
</td>
<td style="text-align:left;">
102.28 (73.16), 1548 (32.1%) missing
</td>
<td style="text-align:left;">
-8.94 (37.19), 387 (30.9%) missing
</td>
<td style="text-align:left;">
-21.31 (13.85), 641 (77%) missing
</td>
</tr>
<tr>
<td style="text-align:left;">
Y31
</td>
<td style="text-align:left;">
-2.38 (15.47), 2067 (25.8%) missing
</td>
<td style="text-align:left;">
-12.43 (11.83), 1029 (94.5%) missing
</td>
<td style="text-align:left;">
-0.12 (15.89), 255 (5.3%) missing
</td>
<td style="text-align:left;">
-5.83 (11.7), 697 (55.7%) missing
</td>
<td style="text-align:left;">
-12.84 (9.34), 86 (10.3%) missing
</td>
</tr>
<tr>
<td style="text-align:left;">
Y32
</td>
<td style="text-align:left;">
35.48 (44.33), 2056 (25.7%) missing
</td>
<td style="text-align:left;">
-14.64 (26.06), 502 (46.1%) missing
</td>
<td style="text-align:left;">
53.2 (34.11), 607 (12.6%) missing
</td>
<td style="text-align:left;">
-1.64 (41.09), 302 (24.1%) missing
</td>
<td style="text-align:left;">
-18.45 (25.23), 645 (77.4%) missing
</td>
</tr>
<tr>
<td style="text-align:left;">
Y33
</td>
<td style="text-align:left;">
54.8 (56.83), 2013 (25.2%) missing
</td>
<td style="text-align:left;">
-8.91 (29.43), 472 (43.3%) missing
</td>
<td style="text-align:left;">
78.75 (44.63), 572 (11.9%) missing
</td>
<td style="text-align:left;">
2.93 (43.14), 339 (27.1%) missing
</td>
<td style="text-align:left;">
-20.56 (20.05), 630 (75.6%) missing
</td>
</tr>
<tr>
<td style="text-align:left;">
Y34
</td>
<td style="text-align:left;">
66.6 (63.23), 2051 (25.6%) missing
</td>
<td style="text-align:left;">
-6.86 (24.06), 109 (10%) missing
</td>
<td style="text-align:left;">
85.17 (56.91), 216 (4.5%) missing
</td>
<td style="text-align:left;">
79.3 (18.82), 1095 (87.5%) missing
</td>
<td style="text-align:left;">
-10.85 (23.65), 631 (75.8%) missing
</td>
</tr>
<tr>
<td style="text-align:left;">
Y35
</td>
<td style="text-align:left;">
73.13 (69.46), 2054 (25.7%) missing
</td>
<td style="text-align:left;">
-1.76 (25.79), 497 (45.6%) missing
</td>
<td style="text-align:left;">
101.32 (60.1), 611 (12.7%) missing
</td>
<td style="text-align:left;">
10.18 (38.83), 311 (24.9%) missing
</td>
<td style="text-align:left;">
-4.17 (18.8), 635 (76.2%) missing
</td>
</tr>
<tr>
<td style="text-align:left;">
Y41
</td>
<td style="text-align:left;">
-1.03 (6.75), 2032 (25.4%) missing
</td>
<td style="text-align:left;">
-5.57 (5.86), 1042 (95.7%) missing
</td>
<td style="text-align:left;">
-0.08 (7.01), 234 (4.8%) missing
</td>
<td style="text-align:left;">
-2.57 (5.18), 678 (54.2%) missing
</td>
<td style="text-align:left;">
-5.36 (3.51), 78 (9.4%) missing
</td>
</tr>
<tr>
<td style="text-align:left;">
Y42
</td>
<td style="text-align:left;">
16.62 (20.72), 2022 (25.3%) missing
</td>
<td style="text-align:left;">
-5.94 (13.11), 489 (44.9%) missing
</td>
<td style="text-align:left;">
24.74 (16.2), 590 (12.2%) missing
</td>
<td style="text-align:left;">
-0.49 (19.22), 296 (23.7%) missing
</td>
<td style="text-align:left;">
-7.92 (11.43), 647 (77.7%) missing
</td>
</tr>
<tr>
<td style="text-align:left;">
Y43
</td>
<td style="text-align:left;">
25.38 (25.81), 2013 (25.2%) missing
</td>
<td style="text-align:left;">
-3.52 (12.92), 461 (42.3%) missing
</td>
<td style="text-align:left;">
36.46 (20.24), 606 (12.6%) missing
</td>
<td style="text-align:left;">
2.21 (19.59), 329 (26.3%) missing
</td>
<td style="text-align:left;">
-8.26 (8.77), 617 (74.1%) missing
</td>
</tr>
<tr>
<td style="text-align:left;">
Y44
</td>
<td style="text-align:left;">
30.33 (29.1), 2023 (25.3%) missing
</td>
<td style="text-align:left;">
-3.52 (10.75), 104 (9.6%) missing
</td>
<td style="text-align:left;">
38.94 (26.15), 204 (4.2%) missing
</td>
<td style="text-align:left;">
36.09 (10.23), 1084 (86.7%) missing
</td>
<td style="text-align:left;">
-6.45 (8.99), 631 (75.8%) missing
</td>
</tr>
<tr>
<td style="text-align:left;">
Y45
</td>
<td style="text-align:left;">
33.81 (31.9), 2086 (26.1%) missing
</td>
<td style="text-align:left;">
-0.73 (12.19), 508 (46.6%) missing
</td>
<td style="text-align:left;">
46.67 (27.58), 628 (13%) missing
</td>
<td style="text-align:left;">
5.21 (18.26), 314 (25.1%) missing
</td>
<td style="text-align:left;">
-2.3 (8.51), 636 (76.4%) missing
</td>
</tr>
<tr>
<td style="text-align:left;">
Y51
</td>
<td style="text-align:left;">
0.95 (5.79), 2077 (26%) missing
</td>
<td style="text-align:left;">
-3.91 (4.47), 1040 (95.5%) missing
</td>
<td style="text-align:left;">
1.77 (5.98), 252 (5.2%) missing
</td>
<td style="text-align:left;">
-0.3 (4.42), 707 (56.5%) missing
</td>
<td style="text-align:left;">
-2.81 (3.15), 78 (9.4%) missing
</td>
</tr>
<tr>
<td style="text-align:left;">
Y52
</td>
<td style="text-align:left;">
16 (17.75), 2034 (25.4%) missing
</td>
<td style="text-align:left;">
-3.48 (10.92), 495 (45.5%) missing
</td>
<td style="text-align:left;">
23 (13.88), 584 (12.1%) missing
</td>
<td style="text-align:left;">
1.08 (16.13), 303 (24.2%) missing
</td>
<td style="text-align:left;">
-5.97 (8.45), 652 (78.3%) missing
</td>
</tr>
<tr>
<td style="text-align:left;">
Y53
</td>
<td style="text-align:left;">
23.58 (22.01), 1976 (24.7%) missing
</td>
<td style="text-align:left;">
-1.15 (11.07), 464 (42.6%) missing
</td>
<td style="text-align:left;">
33.01 (17.23), 579 (12%) missing
</td>
<td style="text-align:left;">
3.92 (16.92), 315 (25.2%) missing
</td>
<td style="text-align:left;">
-5.12 (8.39), 618 (74.2%) missing
</td>
</tr>
<tr>
<td style="text-align:left;">
Y54
</td>
<td style="text-align:left;">
27.66 (24.95), 2047 (25.6%) missing
</td>
<td style="text-align:left;">
-1.17 (9.43), 102 (9.4%) missing
</td>
<td style="text-align:left;">
35.06 (22.39), 203 (4.2%) missing
</td>
<td style="text-align:left;">
32 (8.73), 1114 (89%) missing
</td>
<td style="text-align:left;">
-3.41 (8.35), 628 (75.4%) missing
</td>
</tr>
<tr>
<td style="text-align:left;">
Y55
</td>
<td style="text-align:left;">
30.49 (27.35), 2050 (25.6%) missing
</td>
<td style="text-align:left;">
1.34 (10.71), 498 (45.7%) missing
</td>
<td style="text-align:left;">
41.61 (23.68), 618 (12.8%) missing
</td>
<td style="text-align:left;">
5.85 (15.36), 300 (24%) missing
</td>
<td style="text-align:left;">
-0.25 (7.18), 634 (76.1%) missing
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Clustering quality (silhouette):"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">cluster_result</span><span class="op">$</span><span class="va">silhouette</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Clustering quality (silhouette): 0.135</span></span>
<span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_cissvae.html">run_cissvae</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">df_missing</span>,</span>
<span>  index_col <span class="op">=</span> <span class="st">"index"</span>,</span>
<span>  clusters <span class="op">=</span> <span class="va">cluster_result</span><span class="op">$</span><span class="va">clusters</span>,</span>
<span>  epochs <span class="op">=</span> <span class="fl">5</span>, <span class="co">## short run for demo purposes</span></span>
<span>  return_history <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  device <span class="op">=</span> <span class="st">"cpu"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Cluster dataset:</span></span>
<span><span class="co">#&gt;  ClusterDataset(n_samples=8000, n_features=30, n_clusters=4)</span></span>
<span><span class="co">#&gt;   • Original missing: 61800 / 240000 (25.75%)</span></span>
<span><span class="co">#&gt;   • Validation held-out: 17762 (9.97% of non-missing)</span></span>
<span><span class="co">#&gt;   • .data shape:     (8000, 30)</span></span>
<span><span class="co">#&gt;   • .masks shape:    (8000, 30)</span></span>
<span><span class="co">#&gt;   • .val_data shape: (8000, 30)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="advanced-hyperparameter-optimization-with-autotune">Advanced Hyperparameter Optimization with Autotune<a class="anchor" aria-label="anchor" href="#advanced-hyperparameter-optimization-with-autotune"></a>
</h3>
<div class="section level4">
<h4 id="understanding-parameter-types">Understanding Parameter Types<a class="anchor" aria-label="anchor" href="#understanding-parameter-types"></a>
</h4>
<p>For hyperparameter optimization in <code><a href="../reference/autotune_cissvae.html">autotune_cissvae()</a></code>,
parameters can be specified as:</p>
<ul>
<li>
<strong>Fixed value</strong>: <code>beta = 0.01</code> → parameter
remains constant across trials</li>
<li>
<strong>Categorical choice</strong>: <code>c(64, 128, 256)</code> →
Optuna selects from the provided options</li>
<li>
<strong>Integer range</strong>: <code>c(1, 4)</code> → Optuna
suggests integers between 1 and 4 (inclusive)</li>
<li>
<strong>Float range</strong>:
<code>reticulate::tuple(1e-4, 1e-3)</code> → Optuna suggests floats in
the specified range</li>
</ul>
<div class="section level5">
<h5 id="layer-placement-strategies">Layer Placement Strategies<a class="anchor" aria-label="anchor" href="#layer-placement-strategies"></a>
</h5>
<p>The layer arrangement strategies control how shared and unshared
layers are positioned:</p>
<ul>
<li>
<strong><code>"at_end"</code></strong>: Places shared layers at the
end of the encoder or start of the decoder</li>
<li>
<strong><code>"at_start"</code></strong>: Places shared layers at
the start of the encoder or end of the decoder<br>
</li>
<li>
<strong><code>"alternating"</code></strong>: Distributes shared
layers evenly throughout the architecture</li>
<li>
<strong><code>"random"</code></strong>: Uses random placement of
shared layers (with reproducible seed)</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/reticulate/" class="external-link">reticulate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ciss-vae.github.io/rCISS-VAE">rCISSVAE</a></span><span class="op">)</span></span>
<span><span class="fu">reticulate</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/reticulate/reference/use_python.html" class="external-link">use_virtualenv</a></span><span class="op">(</span><span class="st">"./cissvae_environment"</span>, required <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">df_missing</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">clusters</span><span class="op">)</span></span>
<span></span>
<span><span class="va">aut</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/autotune_cissvae.html">autotune_cissvae</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">df_missing</span>,</span>
<span>  index_col <span class="op">=</span> <span class="st">"index"</span>,</span>
<span>  clusters <span class="op">=</span> <span class="va">clusters</span><span class="op">$</span><span class="va">clusters</span>,</span>
<span>  save_model_path <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  save_search_space_path <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n_trials <span class="op">=</span> <span class="fl">3</span>, <span class="co">## Using low number of trials for demo</span></span>
<span>  study_name <span class="op">=</span> <span class="st">"comprehensive_vae_autotune"</span>,</span>
<span>  device_preference <span class="op">=</span> <span class="st">"cpu"</span>,</span>
<span>  show_progress <span class="op">=</span> <span class="cn">FALSE</span>,  <span class="co"># Set true for Rich progress bars with training visualization</span></span>
<span>  optuna_dashboard_db <span class="op">=</span> <span class="st">"sqlite:///optuna_study.db"</span>,  <span class="co"># Save results to database</span></span>
<span>  load_if_exists <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co">## Set true to load and continue study if it exists</span></span>
<span>  seed <span class="op">=</span> <span class="fl">42</span>, </span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  </span>
<span>  <span class="co"># Search strategy options</span></span>
<span>  constant_layer_size <span class="op">=</span> <span class="cn">FALSE</span>,     <span class="co"># Allow different sizes per layer</span></span>
<span>  evaluate_all_orders <span class="op">=</span> <span class="cn">FALSE</span>,     <span class="co"># Sample layer arrangements efficiently</span></span>
<span>  max_exhaustive_orders <span class="op">=</span> <span class="fl">100</span>,     <span class="co"># Limit for exhaustive search</span></span>
<span>  </span>
<span>  <span class="co">## Hyperparameter search space</span></span>
<span>  num_hidden_layers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">5</span><span class="op">)</span>,     <span class="co"># Try 2-5 hidden layers</span></span>
<span>  hidden_dims <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">64</span>, <span class="fl">512</span><span class="op">)</span>,        <span class="co"># Layer sizes from 64 to 512</span></span>
<span>  latent_dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">100</span><span class="op">)</span>,         <span class="co"># Latent dimension range</span></span>
<span>  latent_shared <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>  output_shared <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>  lr <span class="op">=</span> <span class="fl">0.01</span>,  <span class="co"># Learning rate range</span></span>
<span>  decay_factor <span class="op">=</span> <span class="fl">0.99</span>,</span>
<span>  beta <span class="op">=</span> <span class="fl">0.01</span>,  <span class="co"># KL weight range</span></span>
<span>  num_epochs <span class="op">=</span> <span class="fl">500</span>,                <span class="co"># Fixed epochs for demo</span></span>
<span>  batch_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">4000</span><span class="op">)</span>,     <span class="co"># Batch size options</span></span>
<span>  num_shared_encode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  num_shared_decode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="co"># Layer placement strategies - try different arrangements</span></span>
<span>  encoder_shared_placement <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"at_end"</span>, <span class="st">"at_start"</span>, <span class="st">"alternating"</span>, <span class="st">"random"</span><span class="op">)</span>,</span>
<span>  decoder_shared_placement <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"at_start"</span>, <span class="st">"at_end"</span>, <span class="st">"alternating"</span>, <span class="st">"random"</span><span class="op">)</span>,</span>
<span>  </span>
<span>  refit_patience <span class="op">=</span> <span class="fl">2</span>,        <span class="co"># Early stopping patience</span></span>
<span>  refit_loops <span class="op">=</span> <span class="fl">100</span>,                <span class="co"># Fixed refit loops</span></span>
<span>  epochs_per_loop <span class="op">=</span> <span class="fl">100</span>,   <span class="co"># Epochs per refit loop</span></span>
<span>  reset_lr_refit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Analyze results</span></span>
<span><span class="va">imputed</span> <span class="op">&lt;-</span> <span class="va">aut</span><span class="op">$</span><span class="va">imputed</span></span>
<span><span class="va">best_model</span> <span class="op">&lt;-</span> <span class="va">aut</span><span class="op">$</span><span class="va">model</span></span>
<span><span class="va">study</span> <span class="op">&lt;-</span> <span class="va">aut</span><span class="op">$</span><span class="va">study</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="va">aut</span><span class="op">$</span><span class="va">results</span></span>
<span></span>
<span><span class="co"># View best hyperparameters</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Best validation MSE:"</span>, <span class="va">study</span><span class="op">$</span><span class="va">best_value</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Trial results:"</span><span class="op">)</span></span>
<span><span class="va">results</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html" class="external-link">kable_styling</a></span><span class="op">(</span>font_size<span class="op">=</span><span class="fl">12</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot model architecture</span></span>
<span><span class="fu"><a href="../reference/plot_vae_architecture.html">plot_vae_architecture</a></span><span class="op">(</span><span class="va">best_model</span>, title <span class="op">=</span> <span class="st">"Optimized CISSVAE Architecture"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Starting Optuna optimization with 3 trials...</span></span>
<span><span class="co">#&gt; Optimization complete. Best trial: 1 (MSE: 9.860881)</span></span>
<span><span class="co">#&gt; Training final model with best parameters...</span></span>
<span><span class="co">#&gt; Final model training complete.</span></span>
<span><span class="co">#&gt; Best validation MSE: 9.860881</span></span>
<span><span class="co">#&gt; [1] "Trial results:"</span></span></code></pre>
<table class="table table" style="font-size: 12px; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:right;">
trial_number
</th>
<th style="text-align:right;">
val_mse
</th>
<th style="text-align:right;">
num_hidden_layers
</th>
<th style="text-align:right;">
hidden_dim_0
</th>
<th style="text-align:right;">
hidden_dim_1
</th>
<th style="text-align:right;">
hidden_dim_2
</th>
<th style="text-align:right;">
hidden_dim_3
</th>
<th style="text-align:right;">
hidden_dim_4
</th>
<th style="text-align:right;">
latent_dim
</th>
<th style="text-align:left;">
latent_shared
</th>
<th style="text-align:left;">
output_shared
</th>
<th style="text-align:right;">
batch_size
</th>
<th style="text-align:right;">
num_shared_encode
</th>
<th style="text-align:right;">
num_shared_decode
</th>
<th style="text-align:left;">
encoder_shared_placement
</th>
<th style="text-align:left;">
decoder_shared_placement
</th>
<th style="text-align:left;">
layer_order_enc_used
</th>
<th style="text-align:left;">
layer_order_dec_used
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
474.477020
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
512
</td>
<td style="text-align:right;">
512
</td>
<td style="text-align:right;">
512
</td>
<td style="text-align:right;">
512
</td>
<td style="text-align:right;">
64
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
4000
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
at_start
</td>
<td style="text-align:left;">
random
</td>
<td style="text-align:left;">
S,U,U,U,U
</td>
<td style="text-align:left;">
S,U,U,U,U
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
9.860881
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
512
</td>
<td style="text-align:right;">
64
</td>
<td style="text-align:right;">
NaN
</td>
<td style="text-align:right;">
NaN
</td>
<td style="text-align:right;">
NaN
</td>
<td style="text-align:right;">
100
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
1000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
alternating
</td>
<td style="text-align:left;">
alternating
</td>
<td style="text-align:left;">
U,U
</td>
<td style="text-align:left;">
S,S
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
56.839573
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
512
</td>
<td style="text-align:right;">
64
</td>
<td style="text-align:right;">
512
</td>
<td style="text-align:right;">
512
</td>
<td style="text-align:right;">
512
</td>
<td style="text-align:right;">
100
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
1000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
random
</td>
<td style="text-align:left;">
alternating
</td>
<td style="text-align:left;">
U,U,U,U,U
</td>
<td style="text-align:left;">
S,U,S,U,U
</td>
</tr>
</tbody>
</table>
<pre><code><span><span class="co">#&gt; Plot saved to: autotune_vae_arch.png</span></span></code></pre>
<div class="figure">
<img src="autotune_vae_arch.png" alt=""><p class="caption">Autotuned VAE Architecture</p>
</div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Using Pre-computed Missingness Proportion Matrix -- not quite working yet</span></span>
<span></span>
<span><span class="co">##For advanced control over the clustering process, you can provide a pre-computed missingness proportion matrix directly to `run_cissvae()`:</span></span>
<span></span>
<span><span class="co">## Standardize df_missing column names to feature_timepoint format</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">df_missing</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'index'</span>, <span class="st">'Age'</span>, <span class="st">'Salary'</span>, <span class="st">'ZipCode10001'</span>, <span class="st">'ZipCode20002'</span>, <span class="st">'ZipCode30003'</span>, <span class="st">'Y1_1'</span>, <span class="st">'Y1_2'</span>, <span class="st">'Y1_3'</span>, <span class="st">'Y1_4'</span>, <span class="st">'Y1_5'</span>, <span class="st">'Y2_1'</span>, <span class="st">'Y2_2'</span>, <span class="st">'Y2_3'</span>, <span class="st">'Y2_4'</span>, <span class="st">'Y2_5'</span>, <span class="st">'Y3_1'</span>, <span class="st">'Y3_2'</span>, <span class="st">'Y3_3'</span>, <span class="st">'Y3_4'</span>, <span class="st">'Y3_5'</span>, <span class="st">'Y4_1'</span>, <span class="st">'Y4_2'</span>, <span class="st">'Y4_3'</span>, <span class="st">'Y4_4'</span>, <span class="st">'Y4_5'</span>, <span class="st">'Y5_1'</span>, <span class="st">'Y5_2'</span>, <span class="st">'Y5_3'</span>, <span class="st">'Y5_4'</span>, <span class="st">'Y5_5'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create and examine missingness proportion matrix</span></span>
<span><span class="va">prop_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_missingness_prop_matrix.html">create_missingness_prop_matrix</a></span><span class="op">(</span><span class="va">df_missing</span>, </span>
<span>index_col <span class="op">=</span> <span class="st">"index"</span>, </span>
<span>cols_ignore <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Age'</span>, <span class="st">'Salary'</span>, <span class="st">'ZipCode10001'</span>, <span class="st">'ZipCode20002'</span>, <span class="st">'ZipCode30003'</span><span class="op">)</span>,</span>
<span>repeat_feature_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Y1"</span>, <span class="st">"Y2"</span>, <span class="st">"Y3"</span>, <span class="st">"Y4"</span>, <span class="st">"Y5"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Missingness proportion matrix dimensions:"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Missingness proportion matrix dimensions:"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">prop_matrix</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 8000    5</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Sample of proportion matrix:"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Sample of proportion matrix:"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">prop_matrix</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    Y1  Y2  Y3  Y4  Y5</span></span>
<span><span class="co">#&gt; 1 0.4 0.4 0.2 0.4 0.2</span></span>
<span><span class="co">#&gt; 2 0.4 0.2 0.2 0.2 0.2</span></span>
<span><span class="co">#&gt; 3 0.4 0.2 0.2 0.4 0.2</span></span>
<span><span class="co">#&gt; 4 0.4 0.2 0.4 0.4 0.2</span></span>
<span><span class="co">#&gt; 5 0.4 0.4 0.2 0.2 0.4</span></span>
<span><span class="co">#&gt; 6 0.2 0.2 0.4 0.2 0.4</span></span>
<span></span>
<span><span class="co"># Use proportion matrix with scaling for better clustering</span></span>
<span><span class="va">advanced_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_cissvae.html">run_cissvae</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">df_missing</span>,</span>
<span>  index_col <span class="op">=</span> <span class="st">"index"</span>,</span>
<span>  clusters <span class="op">=</span> <span class="cn">NULL</span>,  <span class="co"># Let function cluster using prop_matrix</span></span>
<span>  columns_ignore <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Age'</span>, <span class="st">'Salary'</span>, <span class="st">'ZipCode10001'</span>, <span class="st">'ZipCode20002'</span>, <span class="st">'ZipCode30003'</span><span class="op">)</span>, </span>
<span>  missingness_proportion_matrix <span class="op">=</span> <span class="va">prop_matrix</span>,</span>
<span>  scale_features <span class="op">=</span> <span class="cn">TRUE</span>,  <span class="co"># Standardize features before clustering</span></span>
<span>  n_clusters <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  leiden_resolution <span class="op">=</span> <span class="fl">0.1</span>,  <span class="co"># HDBSCAN parameter</span></span>
<span>  epochs <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  return_history <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  return_silhouettes <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  device <span class="op">=</span> <span class="st">"cpu"</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Cluster dataset:</span></span>
<span><span class="co">#&gt;  ClusterDataset(n_samples=8000, n_features=30, n_clusters=4)</span></span>
<span><span class="co">#&gt;   • Original missing: 61800 / 200000 (30.90%)</span></span>
<span><span class="co">#&gt;   • Validation held-out: 13786 (9.98% of non-missing)</span></span>
<span><span class="co">#&gt;   • .data shape:     (8000, 30)</span></span>
<span><span class="co">#&gt;   • .masks shape:    (8000, 30)</span></span>
<span><span class="co">#&gt;   • .val_data shape: (8000, 30)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Clustering quality:"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Clustering quality:"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Silhouette score:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">advanced_result</span><span class="op">$</span><span class="va">silhouette_width</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Silhouette score: 0.656"</span></span>
<span></span>
<span><span class="co"># Plot training history</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">advanced_result</span><span class="op">$</span><span class="va">history</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">advanced_result</span><span class="op">$</span><span class="va">history</span><span class="op">$</span><span class="va">epoch</span>, <span class="va">advanced_result</span><span class="op">$</span><span class="va">history</span><span class="op">$</span><span class="va">val_mse</span>, </span>
<span>       type <span class="op">=</span> <span class="st">"l"</span>, main <span class="op">=</span> <span class="st">"Validation MSE During Training"</span>, </span>
<span>       xlab <span class="op">=</span> <span class="st">"Epoch"</span>, ylab <span class="op">=</span> <span class="st">"Validation MSE"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Yasin Khadem Charvadeh, Danielle Vaithilingam, Kenneth Seier, Katherine S. Panageas, Mithat Gönen, Yuan Chen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
