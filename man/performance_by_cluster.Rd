% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/performance.R
\name{performance_by_cluster}
\alias{performance_by_cluster}
\title{Compute per-cluster and per-group performance metrics (MSE, BCE)}
\usage{
performance_by_cluster(
  res,
  clusters = NULL,
  group_col = NULL,
  feature_cols = NULL,
  binary_features = character(0),
  by_group = TRUE,
  by_cluster = TRUE,
  cols_ignore = NULL
)
}
\arguments{
\item{res}{A list containing CISS-VAE run outputs. Must include:
\itemize{
\item \code{res$val_data}: validation data frame (with \code{NA} for non-validation cells)
\item \code{res$val_imputed}: model-imputed validation predictions
\item \code{res$clusters}: cluster labels for each row
}}

\item{clusters}{Optional vector (same length as rows in \code{val_data}) of cluster labels.
If \code{NULL}, will use \code{res$clusters}.}

\item{group_col}{Optional character, name of the column in \code{val_data} for grouping.}

\item{feature_cols}{Character vector specifying which feature columns to evaluate. Defaults to all numeric
columns except \code{group_col} and those in \code{cols_ignore}.}

\item{binary_features}{Character vector naming those columns (subset of \code{feature_cols}) that
should use BCE instead of MSE.}

\item{by_group}{Logical; if \code{TRUE} (default), summarize by \code{group_col}.}

\item{by_cluster}{Logical; if \code{TRUE} (default), summarize by cluster.}

\item{cols_ignore}{Character vector of column names to exclude from scoring (e.g., “id”).}
}
\value{
A named list containing:
\itemize{
\item \code{overall}: overall average metric (MSE for continuous, BCE for binary)
\item \code{per_cluster}: summaries by cluster
\item \code{per_group}: summaries by group
\item \code{group_by_cluster}: summaries by group and cluster
\item \code{per_feature_overall}: average per-feature metric
}
}
\description{
Calculates mean squared error (MSE) for continuous features and binary
cross-entropy (BCE) for features you explicitly mark as binary,
comparing model-imputed validation values against ground-truth validation data.
}
\details{
For features listed in \code{binary_features}, performance is binary cross-entropy (BCE):
\deqn{-[y\log(p) + (1-y)\log(1-p)]}.
For other numeric features, performance is mean squared error (MSE).
}
\examples{
\dontrun{
library(tidyverse)
library(reticulate)
library(rCISSVAE)
library(kableExtra)
library(gtsummary)

data(df_missing)
data(clusters)

result = run_cissvae(
  data = df_missing,
  index_col = "index",
  val_proportion = 0.1, ## pass a vector for different proportions by cluster
  columns_ignore = c("Age", "Salary", "ZipCode10001", "ZipCode20002", "ZipCode30003"), 
  epochs = 5,
  return_silhouettes = FALSE,
  return_history = TRUE,  # Get detailed training history
  verbose = FALSE,
  return_model = TRUE, ## Allows for plotting model schematic
  device = "cpu",  # Explicit device selection
  layer_order_enc = c("unshared", "shared", "unshared"),
  layer_order_dec = c("shared", "unshared", "shared"),
  return_validation_dataset = TRUE
)

performance_by_cluster(res = result, 
  group_col = NULL, 
  clusters = clusters$clusters,
  feature_cols = NULL, ## default, all numeric columns excluding group_col & cols_ignore
  by_group = FALSE,
  by_cluster = TRUE,
  cols_ignore = c( "index", "Age", "Salary", "ZipCode10001", "ZipCode20002", "ZipCode30003") 
)
}

}
